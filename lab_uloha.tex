\documentclass[11pt,a4paper]{article}
\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{float} %kvůli umístění tabulek a podobně.
%\usepackage[]{mcode} %pro matlabovský kód
\usepackage{etoolbox} %kvůli strequal v newcommand



\usepackage[czech]{babel}
\usepackage[utf8]{inputenc}

\usepackage{graphicx}	%kvůli pdf souboru z MATLABu
\usepackage{setspace}	%rozteče v maticích
\usepackage{verbatim}   %víceřádkové komentáře
\usepackage{siunitx}	%hezký jednotky

\sisetup{locale = DE} % kvůli desetinné čárce (př. v siunits.)


% === Formát stránky ===
\usepackage[a4paper]{geometry}
\geometry{
	verbose,
	tmargin=2.2cm,
	bmargin=1.5cm,
	lmargin=1.5cm,
	rmargin=1.5cm}


\title{%
  Laboratorní úloha - modelovací část\\
  \large Rotační kyvadlo}
\author{Tomáš Glabazňa, Matouš Vrba}
\date{\today}

\begin{document}
\maketitle

\clearpage

\section{Rovnice}
\renewcommand{\u}{u}
\newcommand{\x}[2][]{ %první argument je nepovinný, tj. v těchto závorkách []. Pokud to je [t], tak se ta proměnná zobrazí jako funkce času
  \ifstrequal{#1}{t} %podmínka - pokud je první volitelná argument t
   	{x_{#2}(t)} % pak udělej toto
    {x_{#2}}    % jinak udělej toto
}
\newcommand{\xd}[2][]{
  \ifstrequal{#1}{t} 
   	{\dot{x}_{#2}(t)}
    {\dot{x}_{#2}}
}
\newcommand{\y}[1]{y_{#1}}
\newcommand{\M}[1][]{
	\ifstrequal{#1}{t}
	{M(t)}
	{M}
}
\newcommand{\ku}{k_{u}}
\newcommand{\un}{u_{norm}}
\newcommand{\phid}[2][]{
	\ifstrequal{#1}{t}
	{\dot{\varphi}_{#2}(t)}
	{\dot{\varphi}_{#2}}
	}
\newcommand{\phidd}[1]{\ddot{\varphi}_{#1}}
\newcommand{\phin}[2][]{ %phi normální (nederivované)
	\ifstrequal{#1}{t}	
	{\varphi_{#2}(t)}
	{\varphi_{#2}}
	}
\newcommand{\coss}[1]{\cos{(#1)}}
\newcommand{\sinn}[1]{\sin{(#1)}}
\newcommand{\sinnN}[1]{\sin^2{(#1)}} %N = nadruhou

Při popisu systému jsme vycházeli z rovnic popsaných v zadání simulační úlohy. Význam všech zde nedefinovaných proměnných je v něm možné dohledat.

Stavy systému jsme si zvolili jako:
\begin{align*}
& \x{1} = \phin[t]{m}		 && 		\x{2} = \phin[t]{p} \\
& \x{3} = \phid[t]{m}		 &&		\x{4} = \phid[t]{p} \\
\end{align*}

Výstupy jsme definovali jako:
\begin{align*}
& \y{1} = \phin[t]{m}		 &&		\y{2} = \phin[t]{p} \\
\end{align*}

vstup $\u$ pak:
$$
\u = \M[t] = \ku \un
$$
, kde $\un$ je číselný vtup rozhraní k modelu v MATLABu, který je normovaný. $k_u$ je konstanta vyjadřující předpokládanou lineární závislost $\M$ na $\un$.

Stavové rovnice jsou tedy:

\begin{align*}
& \xd{1} = \phid{m}    &&	\xd{2} = \phid{p} \\
\end{align*}
\begin{figure}[H]
\vspace*{-1.3 cm}
$$
\xd{3} =
\frac{
	-J_p k_2 \coss{\x{2}} \x{4}^2 + 2 \delta k_2 \sinn{\x{2}} \x{4} - J_p \M + J_p b \x{3} 	+ k_2 k_3 \coss{\x{2}} \sinn{\x{2}}
}{
 	-J_p k_1 + k_2^2 \sinnN{\x{2}}
}
$$
$$
\xd{4} =
\frac{
	2 \delta \x{4} + k_3 \coss{\x{2}} - \frac{k_2^2}{k_1} \sinn{\x{2}} \coss{\x{2}} 			 	\x{4}^2 - \frac{k_2}{k_1} \sinn{\x{2}} M + \frac{k_2 b}{k_1} \sinn{\x{2}} \x{3}
}{
	-J_p + \frac{k_2^2}{k_1} \sinnN{\x{2}}
}
$$
\end{figure}
\begin{figure}[H]
\vspace*{-1.3 cm}
\begin{align*}
& \y{1} = \x{1}			 &&		\y{2} = \x{2} \\
\end{align*}
\end{figure}

, kde pro konstanty $k_1$, $k_2$ a $k_3$ platí:
$$
k_1 = J_m + m r^2
$$
$$
k_2 = m l r
$$
$$
k_3 = m g l
$$








\section{Linearizace modelu}
Stabilní rovnovážná poloha kyvadla je v pracovním bodě $\mathbf{x_0} = [x_{1p}, x_{2p}, x_{3p}, x_{4p}] = [0, -\frac{\pi}{2}, 0, 0]$, ${u_0} = 0$.
\newline
Matice linearizovaného systému v pracovním bodě $\mathbf{x_0}, u_0$:

\renewcommand{\arraystretch}{1.3}
{\Large
\begin{align*}
&A = 
\begin{pmatrix}
\frac{\partial x_1}{\partial x_1} & \frac{\partial x_1}{\partial x_2} & \frac{\partial x_1}{\partial x_3} & \frac{\partial x_1}{\partial x_4}	\\
\frac{\partial x_2}{\partial x_1} & \frac{\partial x_2}{\partial x_2} & \frac{\partial x_2}{\partial x_3} & \frac{\partial x_2}{\partial x_4}	\\
\frac{\partial x_3}{\partial x_1} & \frac{\partial x_3}{\partial x_2} & \frac{\partial x_3}{\partial x_3} & \frac{\partial x_3}{\partial x_4}	\\
\frac{\partial x_4}{\partial x_1} & \frac{\partial x_4}{\partial x_2} & \frac{\partial x_4}{\partial x_3} & \frac{\partial x_4}{\partial x_4}
\end{pmatrix}_{\biggr\rvert_\mathbf{x_0}} =
\left(\begin{array}{cccc} 0 & 0 & 1 & 0\\ 0 & 0 & 0 & 1\\ 0 & \frac{\mathrm{k_2}\, \mathrm{k_3}}{\mathrm{J_p}\, \mathrm{k_1} - {\mathrm{k_2}}^2} & -\frac{\mathrm{J_p}\, b}{\mathrm{J_p}\, \mathrm{k_1} - {\mathrm{k_2}}^2} & \frac{2\, \mathrm{\delta}\, \mathrm{k_2}}{\mathrm{J_p}\, \mathrm{k_1} - {\mathrm{k_2}}^2}\\ 0 & -\frac{\mathrm{k_3}}{\mathrm{J_p} - \frac{{\mathrm{k_2}}^2}{\mathrm{k_1}}} & \frac{b\, \mathrm{k_2}}{\mathrm{k_1}\, \left(\mathrm{J_p} - \frac{{\mathrm{k_2}}^2}{\mathrm{k_1}}\right)} & -\frac{2\, \mathrm{\delta}}{\mathrm{J_p} - \frac{{\mathrm{k_2}}^2}{\mathrm{k_1}}} \end{array}\right)	\\ \\
&B =
\begin{pmatrix}
\frac{\partial x_1}{\partial u}	\\
\frac{\partial x_2}{\partial u}	\\
\frac{\partial x_3}{\partial u}	\\
\frac{\partial x_4}{\partial u}
\end{pmatrix}_{\biggr\rvert_{u_0}} =
\left(\begin{array}{c} 0\\ 0\\ \frac{\mathrm{J_p}}{\mathrm{J_p}\, \mathrm{k_1} - {\mathrm{k_2}}^2}\\ -\frac{\mathrm{k_2}}{\mathrm{k_1}\, \left(\mathrm{J_p} - \frac{{\mathrm{k_2}}^2}{\mathrm{k_1}}\right)} \end{array}\right)	\\ \\
&C =
\begin{pmatrix}
\frac{\partial y_1}{\partial x_1} & \frac{\partial y_1}{\partial x_2} & \frac{\partial y_1}{\partial x_3} & \frac{\partial y_1}{\partial x_4}	\\
\frac{\partial y_2}{\partial x_1} & \frac{\partial y_2}{\partial x_2} & \frac{\partial y_2}{\partial x_3} & \frac{\partial y_2}{\partial x_4}
\end{pmatrix}_{\biggr\rvert_\mathbf{x_0}} =
\left(\begin{array}{cccc} 1 & 0 & 0 & 0\\ 0 & 1 & 0 & 0 \end{array}\right)	\\ \\
&D =
\begin{pmatrix}
\frac{\partial y_1}{\partial u}	\\
\frac{\partial y_2}{\partial u}
\end{pmatrix}_{\biggr\rvert_{u_0}} =
\left(\begin{array}{c} 0\\ 0 \end{array}\right)
\end{align*}
}

\newpage
\section{Saturace, pásma necitlivosti, apod.}
Vstup systému v MATLABu je normalizován na interval $u_{norm} \in \left<-1; 1\right>$, což vymezuje saturaci vstupu. Pásmo necitlivosti jsme identifikovali v intervalu $\left<-0.007; 0.007\right>$.
\newline
\newline
Při výchylce kyvadla v rozmezí $\pm \SI{12}{\degree}$ je vliv kyvadla na polohu kyvadla zanedbatelný a dá se považovat za pásmo necitlivosti. Toho jsme využili také při identifikaci dynamiky kyvadla z počátečních podmínek.
\newline
\newline
Další nelinearitu jsme identifikovali u ramene, které se na jednu stranu posouvalo snáze, než na druhou.

\section{Identifikace dynamiky motoru (ramene)}
$$
(J_m + m r^2) \phidd{m} - m l r \phidd{p}  \sinn{\phin{p}} - m l r \phid{p}^2 \coss{\phin{p}} + b \phid{m} = \M
$$

\section{Identifikace dynamiky kyvadla}
$$
J_p \phidd{p} + m g l \coss{\phin{p}} - m l r \phidd{m} \sinn{\phin{p}} + 2 \delta \phid{p} = 0
$$

\end{document}